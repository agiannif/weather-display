:showtitle:
:toc: left
:icons: font

= ESP32 Weather E-Paper Display

ESP32-based weather display that fetches data from Open-Meteo API and renders it on an e-paper display. Includes local environmental sensing (BME280/BME680) and battery-powered deep sleep operation.

*No API key required* - Open-Meteo is free and open-source.

== About This Fork

This project is a modified version of https://github.com/lmarzen/esp32-weather-epd[Luke Marzen's esp32-weather-epd].

Please see the original project for hardware list and build guide.

*Key Changes:*

* Migrated from OpenWeatherMap API to Open-Meteo API
* Updated data structures to match Open-Meteo's response format
* Modified internal units to match Open-Meteo's native units (Celsius, km/h, hPa)
* Removed features not available in Open-Meteo (weather alerts, moon phase)
* Added API retry logic for unreliable connections

*Credits:*

* Original project: https://github.com/lmarzen/esp32-weather-epd[esp32-weather-epd] by Luke Marzen
* Open-Meteo API migration and further work: Anthony Fenzl (2026)

Both the original and this fork are licensed under GPL v3.

== Build Commands

All commands run from the `platformio/` directory:

[source,bash]
----
cd platformio
----

=== Build & Flash

[source,bash]
----
pio run                      # Build firmware
pio run -t upload            # Build and flash to device
pio run -t upload --upload-port /dev/ttyUSB0  # Specify port
----

=== Monitor

[source,bash]
----
pio device monitor           # Serial monitor (115200 baud)
pio run -t upload && pio device monitor  # Flash then monitor
----

=== Clean

[source,bash]
----
pio run -t clean             # Remove build artifacts
pio run -t fullclean         # Remove all generated files
----

=== Environment Selection

[source,bash]
----
pio run -e dfrobot_firebeetle2_esp32e   # Default board
pio run -e firebeetle32                  # Alternative board
----

=== Other Useful Commands

[source,bash]
----
pio device list              # List connected devices
pio lib list                 # Show installed libraries
pio lib update               # Update libraries
----

== Configuration

Configuration is split between multiple files in `platformio/`:

=== `src/secrets.h` - Sensitive Configuration (required)

IMPORTANT: Create this file from the template before building:

[source,bash]
----
cp platformio/src/secrets.h.template platformio/src/secrets.h
----

Then edit `platformio/src/secrets.h`:

[source,cpp]
----
// WiFi credentials
const char *WIFI_SSID     = "your-wifi-name";
const char *WIFI_PASSWORD = "your-wifi-password";

// Your location (used for Open-Meteo API requests)
const String LAT = "40.7128";          // Latitude
const String LON = "-74.0060";         // Longitude
const String CITY_STRING = "New York"; // Display name

// Timezone (see https://github.com/nayarsystems/posix_tz_db/blob/master/zones.csv)
const char *TIMEZONE = "EST5EDT,M3.2.0,M11.1.0";

// Open-Meteo API timezone (IANA format or "auto")
const char *API_TIMEZONE = "auto";  // "auto" is recommended
----

NOTE: `secrets.h` is excluded from version control. Never commit this file.

=== `src/config.cpp` - Display & Sleep Settings

[source,cpp]
----
// Sleep configuration
const int SLEEP_DURATION = 30;   // Minutes between updates (2-1440)
const int BED_TIME  = 00;        // Hour to stop updating (0-23)
const int WAKE_TIME = 06;        // Hour to resume updating (0-23)
const int HOURLY_GRAPH_MAX = 24; // Hours shown on graph (8-48)

// API retry configuration
const unsigned API_RETRY_ATTEMPTS = 3;  // Retry attempts for transient errors
const unsigned API_RETRY_DELAY = 2000;  // Delay between retries (ms)
----

=== `include/config.h` - Hardware Selection (uncomment one per section)

[source,cpp]
----
// Display panel
#define DISP_BW_V2    // 7.5" 800x480 B/W (most common)
// #define DISP_3C_B  // 7.5" 800x480 Red/Black/White
// #define DISP_7C_F  // 7.3" 800x480 7-color
// #define DISP_BW_V1 // 7.5" 640x384 B/W

// Driver board
#define DRIVER_DESPI_C02   // Recommended
// #define DRIVER_WAVESHARE // Deprecated

// Sensor
#define SENSOR_BME280
// #define SENSOR_BME680
----

=== `include/config.h` - Units & Locale (uncomment one per section)

[source,cpp]
----
// Locale
#define LOCALE en_US  // Also: de_DE, en_GB, fr_FR, es_ES, it_IT, nl_BE, pt_BR, et_EE, fi_FI

// Temperature
#define UNITS_TEMP_FAHRENHEIT
// #define UNITS_TEMP_CELSIUS
// #define UNITS_TEMP_KELVIN

// Wind speed
#define UNITS_SPEED_MILESPERHOUR
// #define UNITS_SPEED_KILOMETERSPERHOUR
// #define UNITS_SPEED_KNOTS
// #define UNITS_SPEED_METERSPERSECOND

// Pressure
#define UNITS_PRES_INCHESOFMERCURY
// #define UNITS_PRES_HECTOPASCALS
// #define UNITS_PRES_MILLIBARS
----

== Weather Data

This project uses the https://open-meteo.com/[Open-Meteo API] for weather data:

* *Forecast API*: Current conditions, hourly forecast (48h), daily forecast (8 days)
* *Air Quality API*: US AQI index
